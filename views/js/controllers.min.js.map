{"version":3,"file":"routes.js","sources":["routes.js","../WfRunner.js","processBrowser.js"],"names":[],"mappings":"AAqBA,OAAA,gCAAA,WAGA,WCJA,OAAA,qBAAA,SAAA,gBAAA,kBAAA,SAAA,EAAA,cAAA,gBAEA,QAAA,UAAA,qBAAA,WAAA,wBACA,KAAA,qBAAA,qBACA,KAAA,WAAA,WACA,KAAA,MAAA,uBACA,KAAA,gBAAA,KAEA,KAAA,YAEA,KAAA,qBAAA,OAAA,SAAA,KAAA,QAAA,eAAA,MAwDA,MArDA,UAAA,UAAA,YAAA,SAAA,WAAA,eAEA,GAAA,MAAA,IACA,MAAA,gBAAA,WACA,KAAA,SAAA,KAAA,YAEA,WAAA,SAAA,WACA,MAAA,MAAA;GAGA,cAAA,YAAA,cAAA,SAAA,EAAA,eAAA,SAAA,KAEA,WAAA,SAAA,cAAA,IAAA,GAAA,WACA,eAAA,OAAA,gBAIA,SAAA,UAAA,QAAA,WACA,GAAA,MAAA,IAEA,MAAA,gBAAA,KAAA,WACA,GAAA,KAAA,KAAA,qBAAA,mBACA,mBAAA,KAAA,YACA,gBAAA,mBAAA,KAAA,sBACA,OAAA,mBAAA,KAAA,MACA,UAAA,KAAA,QAIA,SAAA,UAAA,SAAA,WACA,GAAA,MAAA,IAEA,MAAA,gBAAA,KAAA,WACA,GAAA,KAAA,KAAA,qBAAA,mBACA,mBAAA,KAAA,YACA,gBAAA,mBAAA,KAAA,sBACA,OAAA,mBAAA,KAAA,MAEA;SAAA,KAAA,KAAA,MAIA,SAAA,KAAA,SAAA,IAAA,MACA,EAAA,UAAA,QAAA,OAAA,SACA,EAAA,eAAA,OAEA,eAAA,OAAA,WAAA,OAIA,OAAA,SAAA,KAAA,KAGA,WCnEA,OAAA,sCAAA,SAAA,SAAA,qBAAA,SAAA,EAAA,EAAA,UAEA,OACA,MAAA,SAAA,SAKA,QAAA,sBACA,MAAA,IAAA,SAAA,KAAA,UAAA,GACA,MAAA,IAAA,SAAA,KAAA,UAAA,GALA,GAAA,OAAA,EAAA,SACA,MAAA,EAAA,SAOA,SAAA,GAAA,UACA,QAAA,qBACA,QAAA,WACA,QAAA,uBAGA,GAAA,QAAA,QAAA,SAAA,SAAA,SACA,SAAA,YAAA,QAAA,IAAA,EAAA,IAAA,QAAA,SAAA,QAAA;GAGA,MAAA,MAAA,SAAA,GACA,EAAA,iBACA,qBACA,SAAA,aAGA,MAAA,MAAA,SAAA,GACA,EAAA,iBACA,qBACA,SAAA,YAGA,EAAA,UAAA,MAAA,WACA,EAAA,gBAAA,OAAA","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n * \n * \n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('wfEngine/controller/routes',[],function(){\n    'use strict';\n\n    return { };\n});\n\n","/*  \r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n * \r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n * \r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n * \r\n * Copyright (c) 2007-2010 (original work) Public Research Centre Henri Tudor & University of Luxembourg) (under the project TAO-QUAL);\r\n *               2008-2010 (update and modification) Deutsche Institut für Internationale Pädagogische Forschung (under the project TAO-TRANSFER);\r\n *               2009-2012 (update and modification) Public Research Centre Henri Tudor (under the project TAO-SUSTAIN & TAO-DEV);\r\n * \r\n */\r\ndefine('wfEngine/WfRunner',['jquery', 'iframeResizer', 'iframeNotifier'], function($, iframeResizer, iframeNotifier){\r\n\r\n    function WfRunner(activityExecutionUri, processUri, activityExecutionNonce) {\r\n            this.activityExecutionUri = activityExecutionUri;\r\n            this.processUri = processUri;\r\n            this.nonce = activityExecutionNonce;\r\n            this.childServiceApi = null;\r\n\r\n            this.services = [];\r\n\r\n            this.processBrowserModule = window.location.href.replace(/^(.*\\/)[^/]*/, \"$1\");\r\n    }\r\n\r\n    WfRunner.prototype.initService = function(serviceApi, $serviceFrame, style) {\r\n        \r\n        var self = this;\r\n        this.childServiceApi = serviceApi;\r\n        this.services.push(serviceApi);\r\n\r\n        serviceApi.onFinish(function() {\r\n            return self.forward();\r\n        });\r\n\r\n        iframeResizer.eventHeight($serviceFrame, parseInt($('#navigation').height(), 10));\r\n\r\n        serviceApi.loadInto($serviceFrame.get(0), function(){\r\n            iframeNotifier.parent('unloading');\r\n        });\r\n    };\r\n\r\n    WfRunner.prototype.forward = function() {\r\n        var that = this;\r\n        \r\n        this.childServiceApi.kill(function (signal) {\r\n            var url = that.processBrowserModule + 'next'\r\n            + '?processUri=' + encodeURIComponent(that.processUri)\r\n            + '&activityUri=' + encodeURIComponent(that.activityExecutionUri)\r\n            + '&nc=' + encodeURIComponent(that.nonce);\r\n            WfRunner.move(url);\r\n        });\r\n    };\r\n\r\n    WfRunner.prototype.backward = function() {\r\n        var that = this;\r\n        \r\n        this.childServiceApi.kill(function (signal) {\r\n            var url = that.processBrowserModule + 'back'\r\n            + '?processUri=' + encodeURIComponent(that.processUri)\r\n            + '&activityUri=' + encodeURIComponent(that.activityExecutionUri)\r\n            + '&nc=' + encodeURIComponent(that.nonce);\r\n\r\n            WfRunner.move(url, true);\r\n        });\r\n    };\r\n\r\n    WfRunner.move = function(url, back){\r\n        $('#tools').empty().height('300px');\r\n        $('#navigation').hide();\r\n\r\n        iframeNotifier.parent('loading', [back]);\r\n\r\n        // this should be change in favor of an ajax request to get data and set\r\n        // up again the wfRunner\r\n        window.location.href = url;\r\n    };\r\n\r\n    return WfRunner;\r\n});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('wfEngine/controller/processBrowser',['jquery', 'lodash', 'wfEngine/WfRunner'], function($, _, WfRunner){\n    \n    return {\n        start : function(options){\n            \n            var $back = $('#back');\n            var $next = $(\"#next\");\n            \n            function deactivateControls(){\n                 $back.off('click').attr('active', false);\n                 $next.off('click').attr('active', false);\n            }\n            \n            var wfRunner = new WfRunner(\n                options.activityExecutionUri,\n                options.processUri,\n                options.activityExecutionNonce\n            );\n    \n            _.forEach(options.services, function(service){\n                wfRunner.initService(service.api, $('#' + service.frameId), service.style);\n            });\n\n            $back.click(function(e){\n                e.preventDefault();\n                deactivateControls();\n                wfRunner.backward();\n            });\n            \n            $next.click(function(e){\n                e.preventDefault();\n                deactivateControls();\n                wfRunner.forward();\n            });\n\n            $(\"#debug\").click(function(){\n                $(\"#debugWindow\").toggle('slow');\n            });\n        }\n    };\n            \n});\n"]}